@echo off
setlocal enabledelayedexpansion

REM Output CSV file
set "output=azure_firewall_status.csv"
echo Subscription Name,Subscription ID,Firewall Deployed > "%output%"

REM Get all subscriptions
for /f "delims=" %%s in ('az account list --query "[].{name:name, id:id}" -o tsv') do (
    for /f "tokens=1,* delims=	" %%a in ("%%s") do (
        set "subName=%%a"
        set "subId=%%b"
        call :processSubscription "!subName!" "!subId!"
    )
)

echo.
echo âœ… Output written to %output%
pause
exit /b

:processSubscription
setlocal
set "subName=%~1"
set "subId=%~2"

REM Set the subscription context
az account set --subscription "%subId%" >nul 2>&1

REM Default value
set "fwStatus=NO"

REM Check if any Azure Firewalls exist
for /f %%f in ('az network firewall list --query "length(@)" -o tsv 2^>nul') do (
    if %%f GTR 0 (
        set "fwStatus=YES"
    )
)

REM Write to CSV
echo %subName%,%subId%,%fwStatus%>>"%output%"
echo %subName% - Firewall: %fwStatus%

endlocal
exit /b



 How to Use:
Open Notepad and paste the script.

Save it as check_firewall.cmd.

Right-click the file and choose "Run as Administrator" (if you have permission).

Make sure az CLI is installed and you're already logged in via az login.
