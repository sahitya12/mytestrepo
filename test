# Output CSV file
$outputFile = "route_table_report.csv"
"RouteTableName,ResourceGroup,RouteName,AddressPrefix,NextHopType,NextHopIpAddress" | Out-File -FilePath $outputFile -Encoding utf8

# Get all route tables in the current subscription
$routeTables = az network route-table list --query "[].{name:name, rg:resourceGroup}" -o tsv

foreach ($rt in $routeTables) {
    $parts = $rt -split "`t"
    $rtName = $parts[0]
    $rgName = $parts[1]

    # Get routes in the route table
    $routesJson = az network route-table route list --route-table-name $rtName --resource-group $rgName -o json
    $routes = $routesJson | ConvertFrom-Json

    foreach ($route in $routes) {
        $routeName = $route.name
        $addressPrefix = $route.addressPrefix
        $nextHopType = $route.nextHopType
        $nextHopIp = if ($null -ne $route.nextHopIpAddress) { $route.nextHopIpAddress } else { "N/A" }

        "$rtName,$rgName,$routeName,$addressPrefix,$nextHopType,$nextHopIp" | Out-File -Append -FilePath $outputFile
    }
}

Write-Output "`nâœ… Route table report generated: $outputFile"







Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
.\adls-ip-report.ps1
