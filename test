@echo off
setlocal enabledelayedexpansion

REM Define output CSV file
set "OUTPUT=azure_firewall_status.csv"
echo Subscription Name,Subscription ID,Firewall Deployed > "%OUTPUT%"

REM Loop through each subscription
for /f "tokens=*" %%i in ('az account list --query "[].{name:name, id:id}" -o tsv') do (
    for /f "tokens=1,2 delims=	" %%a in ("%%i") do (
        set "SUB_NAME=%%a"
        set "SUB_ID=%%b"

        REM Set current subscription
        call az account set --subscription "!SUB_ID!" >nul 2>&1

        REM Default value
        set "FIREWALL=NO"

        REM Check if any firewalls exist
        for /f %%c in ('az network firewall list --query "length(@)" -o tsv 2^>nul') do (
            if %%c GTR 0 (
                set "FIREWALL=YES"
            )
        )

        REM Write to output
        echo !SUB_NAME!,!SUB_ID!,!FIREWALL! >> "%OUTPUT%"
        echo Checked: !SUB_NAME! - Firewall: !FIREWALL!
    )
)

echo.
echo âœ… Output written to %OUTPUT%
pause




 How to Use:
Open Notepad and paste the script.

Save it as check_firewall.cmd.

Right-click the file and choose "Run as Administrator" (if you have permission).

Make sure az CLI is installed and you're already logged in via az login.
